#!/usr/bin/env bash

set -e

READLINK=$(type greadlink &>/dev/null && echo greadlink || echo readlink)

MODULE_DIR="$( cd "$( dirname "$($READLINK -f ${BASH_SOURCE[0]})" )" && cd .. && pwd )"

JSON_TOOL=$MODULE_DIR/node_modules/.bin/json

PROJECT=$(cat package.json | $JSON_TOOL name)

DIRECTORY=${1:-/tmp}

VERSION=$(npm-preserve-version)

FILE_NAME=$PROJECT-$VERSION.tar.gz

if [ ! -f $DIRECTORY/$FILE_NAME ]; then
    echo "$DIRECTORY/$FILE_NAME NOT FOUND"
    exit 1
fi

rm -rf node_modules

tar -xzf $DIRECTORY/$FILE_NAME -C ./
